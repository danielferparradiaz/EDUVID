<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Formulario Course</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f6f8fa; padding:20px; }
    .container { max-width:700px; margin:0 auto; background:#fff; padding:24px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
    h1 { margin-top:0; font-size:20px; }
    label { display:block; margin-bottom:6px; font-weight:600; }
    input[type="text"], input[type="number"], input[type="url"], input[type="datetime-local"], textarea, select {
      width:100%; padding:10px; border:1px solid #d1d5db; border-radius:6px; margin-bottom:12px; box-sizing:border-box;
    }
    textarea { min-height:120px; resize:vertical; }
    .row { display:flex; gap:12px; }
    .col { flex:1; }
    .actions { display:flex; gap:8px; align-items:center; }
    button { padding:10px 14px; border-radius:8px; border:none; cursor:pointer; }
    button.primary { background:#2563eb; color:white; }
    button.ghost { background:#eef2ff; color:#111827; }
    .help { color:#6b7280; font-size:13px; margin-bottom:12px; }
    .message { padding:10px; border-radius:6px; margin-top:12px; display:none; }
    .message.success { background:#ecfdf5; color:#065f46; }
    .message.error { background:#ffefef; color:#7f1d1d; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Crear / Editar Course</h1>
    <p class="help">Rellena los campos y pulsa <strong>Guardar</strong>. El campo <em>id</em> está oculto y se utiliza solo al editar.</p>

    <form id="courseForm" novalidate>
      <!-- id (oculto: para edición) -->
      <input type="hidden" id="id" name="id" value="">

      <label for="instructorId">Instructor (instructorId) — <small>teacher_id en la DB</small></label>
      <input id="instructorId" name="instructorId" type="number" required min="1" placeholder="ID del instructor (número entero)" />

      <label for="nombre">Nombre (nombre) — <small>title en la DB</small></label>
      <input id="nombre" name="nombre" type="text" required maxlength="255" placeholder="Título del curso" />

      <label for="descripcion">Descripción (descripcion) — <small>description en la DB</small></label>
      <textarea id="descripcion" name="descripcion" placeholder="Descripción del curso (opcional)"></textarea>

      <label for="videoUrl">URL del Video (videoUrl) — <small>video_url en la DB</small></label>
      <input id="videoUrl" name="videoUrl" type="url" placeholder="https://..." />

      <label for="category">Categoría (category)</label>
      <input id="category" name="category" type="text" maxlength="100" placeholder="Ej: programación, matemáticas" />

      <div class="row">
        <div class="col">
          <label for="createdAt">Creado (createdAt) — <small>created_at en la DB</small></label>
          <input id="createdAt" name="createdAt" type="datetime-local" required />
        </div>
        <div class="col">
          <label for="updatedAt">Actualizado (updatedAt) — <small>updated_at en la DB</small></label>
          <input id="updatedAt" name="updatedAt" type="datetime-local" required />
        </div>
      </div>

      <div class="actions">
        <button class="primary" type="submit">Guardar</button>
        <button class="ghost" type="button" id="resetBtn">Limpiar</button>
      </div>

      <div id="msgSuccess" class="message success">Guardado correctamente.</div>
      <div id="msgError" class="message error">Ocurrió un error. Revisa la consola.</div>
    </form>
  </div>

  <script>
    // Ajusta esta URL al endpoint real de tu API
    const API_URL = '/api/courses'; // ejemplo: '/api/courses' o 'https://miapi.com/courses'

    // Inicializar createdAt/updatedAt con la fecha actual en formato datetime-local
    function toDatetimeLocalString(date = new Date()) {
      const pad = (n) => String(n).padStart(2, '0');
      const yyyy = date.getFullYear();
      const mm = pad(date.getMonth() + 1);
      const dd = pad(date.getDate());
      const hh = pad(date.getHours());
      const min = pad(date.getMinutes());
      return `${yyyy}-${mm}-${dd}T${hh}:${min}`;
    }

    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('courseForm');
      const resetBtn = document.getElementById('resetBtn');
      const msgSuccess = document.getElementById('msgSuccess');
      const msgError = document.getElementById('msgError');

      // por defecto llenar createdAt/updatedAt con ahora
      document.getElementById('createdAt').value = toDatetimeLocalString();
      document.getElementById('updatedAt').value = toDatetimeLocalString();

      resetBtn.addEventListener('click', () => {
        form.reset();
        document.getElementById('createdAt').value = toDatetimeLocalString();
        document.getElementById('updatedAt').value = toDatetimeLocalString();
        msgSuccess.style.display = msgError.style.display = 'none';
      });

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        msgSuccess.style.display = msgError.style.display = 'none';

        // Validación simple del formulario
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        // Construir objeto según tu modelo (notar nombres de propiedad JS: usar los nombres del modelo exportado)
        const payload = {
          id: document.getElementById('id').value || undefined, // undefined si es creación
          instructorId: parseInt(document.getElementById('instructorId').value, 10),
          nombre: document.getElementById('nombre').value.trim(),
          descripcion: document.getElementById('descripcion').value.trim() || null,
          videoUrl: document.getElementById('videoUrl').value.trim() || null,
          category: document.getElementById('category').value.trim() || null,
          createdAt: document.getElementById('createdAt').value ? new Date(document.getElementById('createdAt').value).toISOString() : null,
          updatedAt: document.getElementById('updatedAt').value ? new Date(document.getElementById('updatedAt').value).toISOString() : null
        };

        // Eliminar undefined para creación
        if (!payload.id) delete payload.id;

        try {
          // Si hay id, hacemos PUT para editar; si no, POST para crear
          const method = payload.id ? 'PUT' : 'POST';
          const url = payload.id ? `${API_URL}/${payload.id}` : API_URL;

          const resp = await fetch(url, {
            method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (!resp.ok) {
            const text = await resp.text();
            console.error('Error response', resp.status, text);
            throw new Error('Error en la petición: ' + resp.status);
          }

          // Respuesta correcta
          msgSuccess.style.display = 'block';
        } catch (err) {
          console.error(err);
          msgError.style.display = 'block';
        }
      });
    });
  </script>
</body>
</html>
